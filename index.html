<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" http-equiv="Cache-control" content="no-cache">
    <title>ANKI Track builder</title>
  </head>
  <link href='https://fonts.googleapis.com/css?family=Antic' rel='stylesheet'>
  <style>
    body{
      height: 100vh;
      width: 100vw;
      padding: 0;
      margin: 0;
      overflow: hidden;
    }
    *{
      outline: none;
    }
    body, input, button{
      font-family: 'Antic';
    }

    ._marquee {
      overflow: hidden;
      position: relative;
      font-size: 1em;
      height: 1em;
      font-weight: bold;
      padding: 5px;
    }
    ._marquee p, ._marquee span{
      position: absolute;
      width: 100%;
      height: 100%;
      margin: 0;
      line-height: 1em;
    }
    ._marquee span{
      text-align: center;
    }
    ._marquee._run span, ._marquee p{
      display: none;
    }
    ._marquee._run p {
      transform: translateX(100%);
      display: inline;
      animation: scroll-left 10s linear infinite;
    }
    ._marquee p:last-of-type{
      animation-delay: 5s;
    }
    @keyframes scroll-left {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    ._floatingButton{
      position:fixed;
    }
    ._pieButton{
      background-color: orange;
      border: none;
      position:absolute;
      visibility: hidden;
      opacity: 0;
      font-size: 30px;
      height: 50px;
      width: 50px;
      margin:0px;
      top:0;
      left:0;
      border-top-left-radius:50% !important;
      border-top-right-radius:50% !important;
      border-bottom-left-radius:50% !important;
      border-bottom-right-radius:50% !important;
      transition: margin .1s, visibility .1s, opacity .1s;
    }
    ._pieButton i {
        margin-top: 5px;
    }

    ._diamond {
      transform: rotate(45deg);
    }
    ._diamond button{
      padding: 0;
      margin: 0 -1.5px;
    }
    ._diamond div {
      height: 51px;
    }
    ._diamond i{
      position: fixed;
      transform: rotate(-45deg) translate(0px, -23px);
      height: 50px;
      width: 50px;
    }

    ._floatingButton input, ._floatingButton button{
      background-color: orange;
      border: none;
      font-size: 25px;
      width: 50px;
      height: 50px;
      border-radius: 5px;
    }
    ._floatingButton input:active, ._floatingButton button:active{
      background-color: darkorange;
      border: 2px solid antiquewhite;
    }

    ._detail{
      position: relative;
      transition: width .1s;
    }
    ._detail:hover{
      width: 200px;
    }

    ._detail ._detail_label{
      opacity: 0;
      visibility: hidden;
      vertical-align: middle;
      position: absolute;
      left: 0;
      right:0;
      transition: opacity .2s,visabilty .2s;
    }
    ._detail:hover ._detail_label{
      opacity: 1;
      visibility: visible;
    }

    ._detail i{
      opacity: 1;
      visibility: visible;
      transition: opacity .2s,visabilty .2s;
    }
    ._detail:hover i{
      opacity: 0;
      visibility: hidden;
    }

    ._spinner{
      position: absolute;
      display: inline-block;
      left: 0;
      top: 0;
      width: 40px;
      height: 40px;
      border: solid 5px transparent;
      border-left: solid 5px lime;
      animation: spin 1s linear infinite;
    }
    ._detail:hover ._spinner{
      display: none !important;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      50%{
        transform: rotate(180deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    ._roundtop {
      border-top-left-radius:25px !important;
      border-top-right-radius:25px !important;
    }
    ._roundbottom {
      border-bottom-left-radius:25px !important;
      border-bottom-right-radius:25px !important;
    }

    ._backdrop{
      transition: visibility .5s, opacity .5s;
      background-color: rgba(1,1,1,.25);
      position:absolute;
      top:0;
      left:0;
      bottom: 0;
      right:0;
    }

    ._modal{
      position: relative;
      display: inline-block;
      background-color: white;
      border: solid 2px Grey;
      border-radius:10px;
    }

    ._header{
      background-color: orange;
      border: none;
      padding: 10px;
      font-size: 1.25em;
      border-radius: 10px 10px 0 0;
    }
    ._body{
      background-color: white;
      border: none;
      padding: 10px;
    }
    ._footer{
      background-color: lightGrey;
      border: none;
      padding: 10px;
      border-radius: 0 0 10px 10px;
    }
    ._footer button{
      border-radius:10px;
      border: none;
      padding: 5px 10px;
      font-weight: bold;
      font-size: 1.25em;
    }

    ._clear {
      background-color: transparent !important;
      padding: 2px;
      border: none;
    }

    ._red {
      background: red;
    }
    ._green {
      background: lime;
    }
    ._grey {
      background: dimgrey;
      color:white;
    }
    ._black {
      background: black;
    }

    ._red:disabled {
      background: lightcoral;
    }
    ._green:disabled {
      background: lightgreen;
    }

    ._red:active {
      background: darkred;
    }
    ._green:active {
      background: darkgreen;
    }
    ._grey:active {
      background: black;
      color:lightGrey;
    }
    ._black:active {
      line-height: 1.6em;
      font-size: 1.4em;
    }

    ._clear._red {
      color: red;
    }
    ._clear._green {
      color: lime;
    }
    ._clear._grey {
      color: dimgrey;
    }
    ._clear._black {
      color: black;
    }

    ._clear._red:active {
      color: darkred;
    }
    ._clear._green:active {
      color: darkgreen;
    }
    ._clear._grey:active {
      color: black;
    }
    ._clear._black:active {
      line-height: 1.6em;
      font-size: 1.4em;
    }

    ._flex{
      display: flex;
    }
    ._column{
      flex-direction: column;
    }
    ._flex>span {
      flex: 1 1 100%;
    }

    ._btnGroup{
      flex:1 1 100%;
      text-align:center;
      font-size: 2em;
    }
    ._btnGroup>span{
      min-width: 40px;
      display: inline-block;
    }
    ._btnGroup ._clear {
      border: solid black 1px;
      border-radius: 8px;
    }

    ._parts span span::after{
      content: 'x';
    }

    ._padded>*{
      padding: 0 5px;
    }

    ._cog{
      position: absolute;
      /* top: 5px; */
      right: 5px;
      font-size: 1.5em;
      line-height: 1.5em;
    }
  </style>
  <!--  -->
  <body id="body" onload="onload();" onContextMenu="return false;">
    <canvas id="canvas"></canvas>
    <span class="_floatingButton" style="top:15px; left:15px;">
      <button class="_roundtop _roundbottom _detail" onclick="console.log(currentTrack)" id="btnSave">
        <span class="_detail_label">Save&nbsp;Track</span><i class="fas fa-save" aria-hidden="true"></i>
      </button>
      <button class="_roundtop _roundbottom _detail" onclick="uploadTrack()" id="btnLoad">
        <span class="_detail_label">Load&nbsp;Track</span><i class="fas fa-folder-open" aria-hidden="true"></i>
      </button>
      <button class="_roundtop _roundbottom _detail" onclick="clearTrack()" id="btnNew">
         <span class="_detail_label">New&nbsp;Track</span><i class="fas fa-trash-alt" aria-hidden="true"></i>
      </button>
      <button class="_roundtop _roundbottom _detail" id="btnClean">
        <span class="_detail_label">Clean&nbsp;Track</span><i class="fas fa-brush" aria-hidden="true"></i>
      </button>
      <button class="_roundtop _roundbottom _detail" onclick="showGenMenu()" id="btnGen">
        <span class="_detail_label">Generate&nbsp;Tracks</span>
        <i class="fas fa-pencil-ruler" aria-hidden="true"></i>
        <div id="workingSpinner" class="_spinner _roundtop _roundbottom" style="display:none;"></div>
      </button>
      <button class="_roundtop _roundbottom _detail" onclick="showPartsList()" id="btnParts">
        <span class="_detail_label">Parts&nbsp;List</span><i class="fas fa-list" aria-hidden="true"></i>
      </button>
    </span>
    <input type="file" id="fileElem" style="display:none" onchange="handleFiles(this.files)">
    <span class="_floatingButton" style="top:15px; right:15px; text-align:right;">
      <div class="_diamond" style="padding-top: 20px; padding-right: 10px;">
        <div class="">
          <button type="button" class="" onclick="panButton(3)" name="" style="" id="btnUpArrow"><i class="fas fa-angle-double-up" aria-hidden="true"></i></button>
          <button type="button" class="" onclick="panButton(0)" name="" style="" id="btnRightArrow"><i class="fas fa-angle-double-right" aria-hidden="true"></i></button>
        </div>
        <div class="">
          <button type="button" class="" onclick="panButton(2)" name="" style="" id="btnLeftArrow"><i class="fas fa-angle-double-left" aria-hidden="true"></i></button>
          <button type="button" class="" onclick="panButton(1)" name="" style="" id="btnDownArrow"><i class="fas fa-angle-double-down" aria-hidden="true"></i></button>
        </div>
      </div>
      <button class="_roundtop" onclick="modScale(0.2)" value="+" id="btnZoomIn"><i class="fas fa-search-plus" aria-hidden="true"></i></button><br>
      <button class="" onclick="resetScale()" value="=" id="btnZoomReset"><i class="fas fa-expand" aria-hidden="true"></i></button><br>
      <button class="_roundbottom" onclick="modScale(-0.2)" value="-" id="btnZoomOut"><i class="fas fa-search-minus" aria-hidden="true"></i></button><br>
      <button class="_roundtop _roundbottom" style="margin-top: 10px;" value="L" id="btnLayer" onclick="switchLayer()"><i class="fas fa-layer-group" aria-hidden="true"></i></button><br>
    </span>
    <!-- menu buttons -->
    <span>
      <input type="image" src="images/straight.png" name="" class="_pieButton" onclick="addTypeOfTrack(STRAIGHT)" id="STRIAGHT_button"/>
      <input type="image" src="images/right corner.png" name="" class="_pieButton" onclick="addTypeOfTrack(RIGHT)" id="CORNER_button"/>
      <input type="image" src="images/boost.png" name="" class="_pieButton" onclick="addTypeOfTrack(BOOST)" id="BOOST_button"/>
      <input type="image" src="images/ramp.png" name="" class="_pieButton" onclick="addTypeOfTrack(RAMP)" id="RAMP_button"/>
      <input type="image" src="images/intersection.png" name="" class="_pieButton" onclick="addTypeOfTrack(INTERSECTION)" id="INTERSECTION_button"/>
      <input type="image" src="images/jump1.png" name="" class="_pieButton" onclick="addTypeOfTrack(JUMP)" id="JUMP_button"/>
      <button class="_pieButton" onclick="editTrackPiece(1)" id="ROTATERIGHT"><i class="fas fa-redo" aria-hidden="true"></i></button>
      <button class="_pieButton" onclick="editTrackPiece(2)" id="ROTATELEFT"><i class="fas fa-undo" aria-hidden="true"></i></button>
      <button class="_pieButton" onclick="editTrackPiece(0)" id="DELETE"><i class="fas fa-trash-alt" aria-hidden="true"></i></button>
      <button class="_pieButton" onclick="editTrackPiece(3)" id="SWITCH"><i class="fas fa-exchange-alt" aria-hidden="true"></i></button>
      <img src="" height="50" width="50" style="display: none; opacity:.75; position:absolute; pointer-events: none;" id="dragIcon" />
    </span>
    <!--Track piece images-->
    <span>
      <img src="images/start.png" style="display: none;" id="imgStart" />
      <img src="images/right corner.png" style="display: none;" id="imgCornerR" />
      <img src="images/left corner.png" style="display: none;" id="imgCornerL" />
      <img src="images/straight.png" style="display: none;" id="imgStraight" />
      <img src="images/boost.png" style="display: none;" id="imgBoost" />
      <img src="images/ramp.png" style="display: none;" id="imgRamp" />
      <img src="images/intersection.png" style="display: none;" id="imgIntersection" />
      <img src="images/jump1.png" style="display: none;" id="imgJumpLaunch" />
      <img src="images/jump2.png" style="display: none;" id="imgJumpCatch" />
    </span>
    <!-- generation menu -->
    <div id="genMenuBack" class="_backdrop _flex" onclick="hideGenMenu()" style="visibility:hidden; opacity:0">
      <span></span>
      <div class="_flex _column">
        <span style="flex:1 1 50%"></span>
        <div id="genMenu" class="_modal">
          <div class="_header">
            Select Pieces for Auto Generation
          </div>
          <div class="_body">
            <div class="_flex">
              <img src="images/straight.png" width="150" height="150"/>
              <img src="images/right corner.png" width="150" height="150"/>
              <img src="images/ramp.png" width="150" height="150"/>
              <img src="images/intersection.png" width="150" height="150"/>
              <img src="images/jump1.png" width="150" height="150"/>
            </div>
            <div class="_flex">
              <span class="_btnGroup">
                <button class="_clear _green" onclick="poolSet(STRAIGHT,1)"  style="">
                  <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                </button>
                <span id="straight_counter">0</span>
                <button class="_clear _red" onclick="poolSet(STRAIGHT,-1)"  style="">
                  <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                </button>
              </span>
              <span class="_btnGroup">
                <button class="_clear _green" onclick="poolSet(LEFT,1)"  style="">
                  <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                </button>
                <span id="corner_counter">0</span>
                <button class="_clear _red" onclick="poolSet(LEFT,-1)"  style="">
                  <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                </button>
              </span>
              <span class="_btnGroup">
                <button class="_clear _green" onclick="poolSet(RAMP,1)"  style="">
                  <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                </button>
                <span id="ramp_counter">0</span>
                <button class="_clear _red" onclick="poolSet(RAMP,-1)"  style="">
                  <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                </button>
              </span>
              <span class="_btnGroup">
                <button class="_clear _green" onclick="poolSet(INTERSECTION,1)"  style="">
                  <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                </button>
                <span id="intersection_counter">0</span>
                <button class="_clear _red" onclick="poolSet(INTERSECTION,-1)"  style="">
                  <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                </button>
              </span>
              <span class="_btnGroup">
                <button class="_clear _green" onclick="poolSet(JUMP,1)"  style="">
                  <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                </button>
                <span id="jump_counter">0</span>
                <button class="_clear _red" onclick="poolSet(JUMP,-1)"  style="">
                  <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                </button>
              </span>
              <span id="boost_counter" style="display:none;">0</span>
            </div>
            <div>
              Maximum consecutive pieces:
              <div class="_flex" >
                <span class="_btnGroup">
                  <button class="_clear _green" onclick="consecSet(STRAIGHT,1)"  style="">
                    <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                  </button>
                  <span id="straight_consec">4</span>
                  <button class="_clear _red" onclick="consecSet(STRAIGHT,-1)"  style="">
                    <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                  </button>
                </span>
                <span class="_btnGroup">
                  <button class="_clear _green" onclick="consecSet(LEFT,1)"  style="">
                    <i class="fas fa-plus fa-2x" aria-hidden="true"></i>
                  </button>
                  <span id="corner_consec">4</span>
                  <button class="_clear _red" onclick="consecSet(LEFT,-1)"  style="">
                    <i class="fas fa-minus fa-2x" aria-hidden="true"></i>
                  </button>
                </span>
                <span class="_btnGroup">
                  <span id="ramp_consec" style="display:none;">9</span>
                </span>
                <span class="_btnGroup">
                  <span id="intersection_consec" style="display:none;">9</span>
                </span>
                <span class="_btnGroup">
                  <span id="jump_consec" style="display:none;">9</span>
                </span>
                <span id="boost_consec" style="display:none;">9</span>
              </div>
            </div>
          </div>
          <div class="_footer _flex">
            <button class="_red" onclick="hideGenMenu()" style="flex: 1 0 150px;">
              <i class="fas fa-times" aria-hidden="true"></i>&nbsp;CANCEL
            </button>
            <span></span>
            <button class="_green" onclick="hideGenMenu();showResMenu();threadGen();"  style="flex: 1 0 150px;">
              GO&nbsp;<i class="fas fa-angle-right" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <span></span>
      </div>
      <span></span>
    </div>
    <div id="resMenuBack" class="_backdrop _flex" onclick="hideResMenu()" style="visibility:hidden; opacity:0">
      <span></span>
      <div class="_flex _column">
        <span style="flex:1 1 50%"></span>
        <div id="resMenu" class="_modal">
          <div class="_header">
            Select a track
          </div>
          <div id="marquee" class="_marquee">
            <p>...Generating tracks...</p>
            <p>...Generating tracks...</p>
            <span>All tracks generated</span>
          </div>
          <div class="_body" style="padding:0;">
            <div class="_flex" style="position:relative">
              <p id="trackCounter" style="position:absolute;top:5px;right:5px;margin:0;"></p>
              <canvas id="trackContainer" width="600" height="400"></canvas>
              <div class="_flex _column">
                <button class="_clear _grey" style="" onclick="trackIndexSet(-1)">
                  <i class="fas fa-angle-up fa-2x" aria-hidden="true"></i>
                </button>
                <button class="_clear _grey" style="" onclick="trackIndexSet(-tracksPerCol)">
                  <i class="fas fa-angle-double-up fa-2x" aria-hidden="true"></i>
                </button>
                <span></span>
                <button class="_clear _grey" style="" onclick="trackIndexSet(tracksPerCol)">
                  <i class="fas fa-angle-double-down fa-2x" aria-hidden="true"></i>
                </button>
                <button class="_clear _grey" style="" onclick="trackIndexSet(1)">
                  <i class="fas fa-angle-down fa-2x" aria-hidden="true"></i>
                </button>
              </div>
              <canvas id="previewCanvas" width="300" height="400"></canvas>
            </div>
          </div>
          <div class="_footer _flex">
            <button class="_red" onclick="hideResMenu()" style="flex: 1 0 150px;">
              <i class="fas fa-times" aria-hidden="true"></i>&nbsp;CANCEL
            </button>
            <span></span>
            <button class="_grey" onclick="hideResMenu(); showGenMenu(true);"  style="flex: 1 0 225px;">
              CHANGE&nbsp;SETTINGS&nbsp;<i class="fas fa-cog" aria-hidden="true"></i>
            </button>
            <span></span>
            <button id="selectTrack" class="_green" onclick="hideResMenu(true)"  style="flex: 1 0 150px;">
              SELECT&nbsp;<i class="fas fa-angle-right" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <span></span>
      </div>
      <span></span>
    </div>
    <div id="partsListBack" class="_backdrop _flex" onclick="hidePartsList()" style="visibility:hidden; opacity:0">
      <span></span>
      <div class="_flex _column">
        <span style="flex:1 1 50%"></span>
        <div id="partsList" class="_modal">
          <div class="_header">
            Pieces required for this track
          </div>
          <div class="_body">
            <div class="_flex _padded">
              <img src="images/start.png" width="50" height="50"/>
              <img src="images/straight.png" width="50" height="50"/>
              <img src="images/right corner.png" width="50" height="50"/>
              <img src="images/intersection.png" width="50" height="50"/>
              <img src="images/boost.png" width="50" height="50"/>
              <img src="images/jump1.png" width="50" height="50"/>
              <P>Risers</P>
            </div>
            <div class="_flex _parts" style="text-align:center;">
              <span><span id="start_list">1</span></span>
              <span><span id="straight_list">0</span></span>
              <span><span id="corner_list">0</span></span>
              <span><span id="intersection_list">0</span></span>
              <span><span id="jump_list">0</span></span>
              <span><span id="boost_list">0</span></span>
              <span><span id="riser_list">0</span></span>
            </div>
          </div>
          <div class="_footer _flex">
            <span></span>
            <button class="_green" onclick="hidePartsList();"  style="flex: 1 0 150px;">
              OK&nbsp;<i class="fas fa-angle-right" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <span></span>
      </div>
      <span></span>
    </div>

  </body>

  <script type="text/javascript" src="index.js"></script>
  <script type="text/javascript" src="generator.js"></script>
  <script src="https://kit.fontawesome.com/0dce990a33.js" crossorigin="anonymous"></script>
</html>
